import{M as b,s as I,_ as L,Q as P}from"./index.vue_vue_type_script_setup_true_lang-CSuimxwc.js";import{a as Q,u as Y,c as A}from"./chatHistory-D8um-KwZ.js";import{d as R,ai as d,o as s,c as h,a as _,V as t,P as r,T as f,U as S,u as v,J as B,F as C,a8 as E,Q as F,W as O,r as w,h as J,O as k,n as W,R as j}from"./vue-39WfQX0x.js";import{e as q,_ as M,i as G}from"./index-Dzv453Ar.js";import{E as T}from"./element-jUUjv72Y.js";import"./vxe-DW97H3iJ.js";var K=(o=>(o.SYSTEM="SYSTEM",o.USER="USER",o))(K||{});const X={class:B({"chat-record":!0,"chat-question":!0})},Z={class:"chat-content"},ee={class:B({"chat-record":!0,"chat-question":!1})},te=R({__name:"ChatRecord",props:{data:{}},setup(o){const e=q(),a=o;return(g,l)=>{const m=d("el-avatar"),p=d("el-text");return s(),h(C,null,[_("div",X,[t(m,{size:24,src:v(e).photo},{default:r(()=>{var n;return[f(S((n=v(e).username)==null?void 0:n[0]),1)]}),_:1},8,["src"]),_("div",Z,[t(p,{type:"info",class:"time"},{default:r(()=>[f(S(a.data.create_time),1)]),_:1}),t(b,{moduleValue:a.data.query},null,8,["moduleValue"])])]),_("div",ee,[t(m,{size:24,src:v(I)},{default:r(()=>[f(S(v(K).SYSTEM),1)]),_:1},8,["src"]),_("div",{class:B({"chat-content":!0,"chat-error":!a.data.response})},[t(p,{type:"info",class:"time"},{default:r(()=>[f(S(a.data.create_time),1)]),_:1}),(s(!0),h(C,null,E(a.data.docs,(n,y)=>F((s(),h("div",{class:"ai-docs-content",key:y},[t(b,{moduleValue:n},null,8,["moduleValue"])])),[[O,!!a.data.docs]])),128)),t(b,{moduleValue:a.data.response},null,8,["moduleValue"])],2)])],64)}}}),ae=M(te,[["__scopeId","data-v-20346045"]]);function oe(o){return G({url:`/api/knowledge-bases/${o}`,method:"get"})}const se={class:"main-center"},ne={class:"chat-input-top"},ce=R({__name:"ChatRecords",setup(o){const e=Q(),a=q(),g=Y(),l=w(null),m=w(""),p=w([]),n=w("");function y(){W(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)})}async function $(u){const c=u||"新对话",V=e.chat_type,x=await A({user_id:a.token,name:c,chat_type:V});e.onSelectConversation(x.id),!u&&e.getChatHistory()}async function N(u){const c=u.trim();if(c){if(!p.value.length){T.warning("请先创建知识库");return}if(!n.value){T.warning("请先选择知识库");return}!e.conversation_id&&await $(c),g.getConversations(),e.chatKnowledge({query:c,knowledge_base_name:n.value})}}async function U(){await $(),g.getConversations()}async function H(){const u=await oe(a.token);p.value=u.data.knowledge_bases}return J(()=>{H(),y(),e.setOnScrollBottom(y)}),(u,c)=>{const V=d("el-button"),x=d("el-option"),z=d("el-select");return s(),h("div",se,[_("div",{class:"chat-records",ref_key:"chatRecordsRef",ref:l},[(s(!0),h(C,null,E(v(e).chat_history,(i,D)=>(s(),k(ae,{key:D,data:i},null,8,["data"]))),128))],512),_("div",null,[_("div",ne,[t(V,{class:"new-chat",onClick:U},{default:r(()=>[f("新建对话")]),_:1}),t(L),t(z,{style:{width:"160px"},modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=i=>n.value=i)},{default:r(()=>[(s(!0),h(C,null,E(p.value,i=>(s(),k(x,{label:i,key:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t(P,{class:"quill-editor",value:m.value,onEnter:N},null,8,["value"])])])}}}),re=M(ce,[["__scopeId","data-v-419b61cc"]]),le=R({__name:"Knowledge",setup(o){const e=w();return(a,g)=>{const l=d("el-main"),m=d("el-container");return s(),k(m,null,{default:r(()=>[t(l,{class:"layout-main"},{default:r(()=>[t(re,{ref_key:"chatRecordsRef",ref:e},null,512)]),_:1})]),_:1})}}}),ue=M(le,[["__scopeId","data-v-5df3e406"]]),fe=R({__name:"index",setup(o){return(e,a)=>(s(),k(j(ue)))}});export{fe as default};
